<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>People For People</title>
    <link rel="stylesheet" href="styles.css" />
    <script type="module" src="app.js"></script>

    <!-- Estilos adicionales: transiciones, bienvenida, chats, Calendario y modo Organizador -->
    <style>
      /* ------------------------------
         Transiciones y Welcome Screen
      ------------------------------ */
      #registration-screen {
        opacity: 1;
        transition: opacity 0.6s ease;
      }
      #registration-screen.fade-out {
        opacity: 0;
      }
      #welcome-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #27ae60, #8e44ad);
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
        padding: 20px;
        box-sizing: border-box;
        text-align: center;
        opacity: 0;
        transition: opacity 0.6s ease;
      }
      #welcome-screen.visible { opacity: 1; }
      #welcome-screen .logo { width: 180px; margin: 20px 0; }
      #welcome-screen .welcome-text { font-size: 4em; margin: 0.2em; }
      #welcome-screen .slogan {
        font-size: 1.5em;
        margin-top: 10px;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
      }
      #welcome-screen #start-btn {
        margin-top: 50px;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
      }
      #welcome-screen .slogan.show,
      #welcome-screen #start-btn.show {
        opacity: 1;
        transform: translateY(0);
      }
      #welcome-screen.fade-out { opacity: 0; }
      @keyframes wave {
        0% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0); }
      }
      .wave-letter { display: inline-block; }
      .wave-letter.animate-wave { animation: wave 1.5s ease-in-out; }
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }
      #welcome-screen #start-btn.pulse { animation: pulse 1s infinite ease-in-out; }

      /* ------------------------------
         Estilos para chats en Fullscreen
      ------------------------------ */
      .chat-container:fullscreen {
        width: 100%;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
        background: #fff;
        position: relative;
      }
      .chat-container:fullscreen .chat-messages {
        height: calc(100% - 120px);
        overflow-y: auto;
      }
      .chat-container:fullscreen form {
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
        margin: 0;
      }
      .chat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f2f2f2;
        padding: 10px;
        border-bottom: 1px solid #ccc;
      }
      .chat-header h3 { margin: 0; font-size: 1.2em; }
      .fullscreen-chat-btn {
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 6px 10px;
      }
      .fullscreen-chat-btn img { width: 24px; height: 24px; }

      /* ------------------------------
         Estilos para Calendario
      ------------------------------ */
      #calendario {
        width: 100%;
        height: calc(100vh - 180px);
        padding: 20px;
        box-sizing: border-box;
        background: #f9f9f9;
        overflow: auto;
      }
      #calendar-container { width: 100%; height: calc(100% - 50px); display: block; }
      #calendar-controls { margin-bottom: 15px; }
      #calendar-controls button { margin-right: 10px; }
      .calendar-view-toggle {
        background: #e0e0e0;
        border: none;
        color: #333;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 1em;
        cursor: pointer;
        transition: background 0.3s, color 0.3s, transform 0.3s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .calendar-view-toggle:hover,
      .calendar-view-toggle.active {
        background: #32cd32;
        color: #fff;
        transform: scale(1.05);
      }
      .calendar-add-event {
        background: #007BFF;
        border: none;
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 1em;
        cursor: pointer;
        transition: background 0.3s, transform 0.3s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .calendar-add-event:hover {
        background: #0056b3;
        transform: scale(1.05);
      }
      .daily-header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 10px;
        background: #e0e0e0;
        border-radius: 4px;
        margin-bottom: 10px;
        font-weight: bold;
      }
      .daily-header-row span { flex: 1; }
      .daily-list { display: flex; flex-direction: column; gap: 10px; }
      .daily-row {
        display: flex;
        align-items: center;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #fff;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        cursor: pointer;
      }
      .daily-row .day-name { width: 100px; font-weight: bold; color: #27ae60; }
      .daily-row .event-info { flex: 1; text-align: right; color: #333; }
      .monthly-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        margin-bottom: 10px;
      }
      .monthly-header div {
        text-align: center;
        font-weight: bold;
        padding: 5px 0;
        background: #e0e0e0;
        border-radius: 4px;
      }
      .monthly-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-auto-rows: 1fr;
        grid-gap: 10px;
      }
      .calendar-cell {
        min-width: 90px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #fff;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        cursor: pointer;
        font-size: 0.9em;
        transition: background 0.3s, transform 0.3s;
      }
      .calendar-cell:hover {
        background: #e6f9e6;
        transform: scale(1.02);
      }
      #event-panel {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        border: 1px solid #ccc;
        padding: 15px 15px 30px;
        border-radius: 6px;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
        z-index: 100;
        max-width: 400px;
        width: 90%;
        max-height: 70vh;
        overflow-y: auto;
      }
      #event-panel h3 { text-align: center; color: #8e44ad; margin-bottom: 15px; }
      #event-panel label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #27ae60;
      }
      #event-panel input,
      #event-panel textarea,
      #event-panel select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      #event-panel button {
        padding: 8px 12px;
        font-size: 0.9em;
        cursor: pointer;
        margin-right: 5px;
        border: none;
        border-radius: 4px;
      }
      #event-panel button:hover { opacity: 0.9; }

      /* ------------------------------
         Resto de estilos (perfil, modales, etc.)
      ------------------------------ */
      .terms-container {
        padding: 10px;
        margin: 10px 0;
        display: inline-flex;
        align-items: center;
        justify-content: flex-start;
        background: #fefefe;
        white-space: nowrap;
      }
      .terms-container label {
        margin-left: 5px;
        font-size: 0.9em;
      }
      .terms-link {
        color: blue;
        text-decoration: underline;
        cursor: pointer;
      }
      /* Estilos para el modal de T√©rminos (centrar im√°genes y sin recuadro de la cabecera) */
      #terms-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8);
      }
      #terms-modal .modal-content {
        background: #fff;
        margin: 10% auto;
        padding: 20px;
        border: none;
        width: 90%;
        max-width: 800px;
        text-align: center;
        position: relative;
      }
      #terms-modal #close-terms {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }
      #terms-modal img {
        display: block;
        margin: -10px auto 10px;
        max-width: 70%;
        height: auto;
        border: none;
        box-shadow: none;
      }
    </style>
  </head>
  <body>
    <!-- Mensaje de Bienvenida / Prototipo -->
    <div id="dev-message">
      <div class="message-box">
        <p>
          Bienvenido a People For People. Este es un prototipo de aplicaci√≥n para la startup de People For People.
          Actualmente estamos integrando las √∫ltimas tecnolog√≠as y desarrollando nuevas funcionalidades para brindar una experiencia de usuario excepcional.
          Le agradecemos por participar en esta fase de pruebas.
        </p>
        <p class="creator">Creado por: Carlos Potenciano</p>
        <button id="accept-dev-message" class="accept-btn">Aceptar</button>
      </div>
    </div>

    <!-- Pantalla de Registro -->
    <div id="registration-screen" class="screen">
      <div class="form-container">
        <h2>Registro</h2>
        <form id="registration-form">
          <input type="text" id="username" placeholder="Nombre de Usuario" required />
          <input type="email" id="email" placeholder="Correo electr√≥nico" required />
          <input type="password" id="password" placeholder="Contrase√±a" required />
          <!-- Bloque de T√©rminos de Privacidad -->
          <div class="terms-container">
            <input type="checkbox" id="accept-terms" required />
            <label for="accept-terms">Acepto los <span class="terms-link" onclick="openTermsModal()">T√©rminos de Privacidad</span></label>
          </div>
          <button type="submit" class="enhanced-btn">Registrarse</button>
        </form>
      </div>
    </div>

    <!-- Aplicaci√≥n Principal (Modo Voluntario) -->
    <div id="main-app" class="screen" style="display: none;">
      <header class="app-header">
        <h1 class="app-title">People For People</h1>
        <div class="header-actions">
          <!-- √çcono Calendario (visible solo en modo Voluntario) -->
          <button id="calendario-btn" data-target="calendario" style="cursor: pointer; background: transparent; border: none; margin-right: 10px;">
            <img src="https://github.com/CharliePoten/People-For-People/blob/main/calendario%20icono.png?raw=true" alt="Calendario" class="calendario-icon" style="width:28px; height:auto;" />
          </button>
          <!-- Bot√≥n de Perfil -->
          <div class="profile-container" id="profile-btn">
            <img src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20perfil.png?raw=true" alt="Perfil" class="profile-img"
              onerror="this.onerror=null; this.src='https://github.com/CharliePoten/People-For-People/blob/main/icono%20perfil.png?raw=true'" />
            <span class="profile-label">Mi perfil</span>
            <div id="profile-dropdown" class="profile-dropdown" style="display: none;">
              <div class="dropdown-item" data-section="perfil">Mi perfil</div>
              <div class="dropdown-item" data-section="ajustes">Ajustes de perfil</div>
              <div class="dropdown-item" data-section="soporte">Soporte</div>
              <div class="dropdown-item" data-section="centro">People for People</div>
              <!-- Bot√≥n para cambiar a organizador -->
              <div class="dropdown-item mode-toggle-btn" style="background-color: #800080; color: white; cursor: pointer;">
                Cambiar a Organizador
              </div>
            </div>
          </div>
        </div>
      </header>
      <main class="app-content" id="content">
        <!-- Secci√≥n Mapa -->
        <div id="map-view" class="content-section">
          <h2>Mapa</h2>
          <div id="map-container">
            <div id="map"></div>
            <button id="fullscreen-btn">Pantalla Completa</button>
          </div>
        </div>
        <!-- Secci√≥n Pedir Ayuda -->
        <div id="pedir-ayuda" class="content-section" style="display:none;">
          <h2>Pedir Ayuda</h2>
          <div id="ayuda-view">
            <div id="ayuda-list-view">
              <button id="mostrar-ayuda-create" class="action-btn">Crear Punto de Ayuda</button>
              <div id="ayuda-list" class="list-box"></div>
            </div>
            <div id="ayuda-create-form" class="form-container" style="display:none;">
              <h3>Nuevo Punto de Ayuda</h3>
              <form id="crear-ayuda-form">
                <input type="text" id="ayuda-titulo" placeholder="T√≠tulo del Punto de Ayuda" required />
                <textarea id="ayuda-info" placeholder="Informaci√≥n del Punto de Ayuda" required></textarea>
                <input type="file" id="ayuda-image" accept="image/*" />
                <button type="submit" class="action-btn">
                  <img src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20enviar.png?raw=true" class="send-icon" alt="Enviar" />
                  Enviar
                </button>
                <button type="button" id="cancelar-ayuda" class="return-btn">Volver</button>
              </form>
            </div>
            <div id="ayuda-detail-view" style="display:none;">
              <button id="volver-ayuda-list" class="return-btn">Volver</button>
              <div id="ayuda-detail"></div>
              <button id="view-on-map" class="map-btn">Ver en el Mapa</button>
              <div id="small-map" style="height: 150px; width: 100%; margin-top: 10px;"></div>
              <div id="ayuda-chat" class="chat-container">
                <div class="chat-header">
                  <h3>Chat de Ayuda</h3>
                  <button type="button" class="fullscreen-chat-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/Pantalla%20completa.png?raw=true" alt="Pantalla Completa" />
                  </button>
                </div>
                <div class="chat-messages" id="ayuda-chat-messages"></div>
                <form id="ayuda-chat-form">
                  <input type="text" id="ayuda-chat-input" placeholder="Escribe tu mensaje" required />
                  <button type="submit" class="enhanced-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20enviar.png?raw=true" class="send-icon" alt="Enviar" />
                    Enviar
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- Secci√≥n Voluntarios -->
        <div id="ofrecer-voluntario" class="content-section" style="display:none;">
          <h2>Voluntarios</h2>
          <div id="voluntario-view">
            <div id="voluntario-list-view">
              <button id="mostrar-voluntario-create" class="action-btn">Ofrecerme como Voluntario</button>
              <div id="voluntario-list" class="list-box"></div>
            </div>
            <div id="voluntario-create-form" class="form-container" style="display:none;">
              <h3>Horarios Disponibles</h3>
              <form id="crear-voluntario-form">
                <div class="slider-group">
                  <label for="dia-inicio">D√≠a inicio: <span id="dia-inicio-label">Lunes</span></label>
                  <input type="range" id="dia-inicio" name="dia-inicio" min="0" max="6" value="0" />
                  <label for="dia-fin">D√≠a fin: <span id="dia-fin-label">Viernes</span></label>
                  <input type="range" id="dia-fin" name="dia-fin" min="0" max="6" value="4" />
                </div>
                <div class="slider-group">
                  <label for="hora-inicio">Hora inicio: <span id="hora-inicio-label">9:00</span></label>
                  <input type="range" id="hora-inicio" name="hora-inicio" min="0" max="23" value="9" />
                  <label for="hora-fin">Hora fin: <span id="hora-fin-label">17:00</span></label>
                  <input type="range" id="hora-fin" name="hora-fin" min="0" max="23" value="17" />
                </div>
                <div class="form-group-voluntario">
                  <label for="voluntario-habilidades">Habilidades</label>
                  <textarea id="voluntario-habilidades" placeholder="Ejemplo: primeros auxilios, carpinter√≠a, etc." required></textarea>
                </div>
                <button type="submit" class="action-btn">Ofrecerme voluntario</button>
                <button type="button" id="cancelar-voluntario" class="return-btn">Volver</button>
              </form>
            </div>
            <div id="voluntario-detail-view" style="display:none;">
              <button id="volver-voluntario-list" class="return-btn">Volver</button>
              <div id="voluntario-detail"></div>
              <!-- Chat Privado (si aplica) -->
              <div id="voluntario-private-chat" class="chat-container">
                <div class="chat-header">
                  <h3>Chat Privado</h3>
                  <button type="button" class="fullscreen-chat-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/Pantalla%20completa.png?raw=true" alt="Pantalla Completa" />
                  </button>
                </div>
                <div class="chat-messages" id="voluntario-private-chat-messages"></div>
                <form id="voluntario-private-chat-form">
                  <input type="text" id="voluntario-private-chat-input" placeholder="Escribe tu mensaje" required />
                  <button type="submit" class="enhanced-btn">Enviar</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- Secci√≥n Organizaciones (Modo Voluntario) -->
        <div id="organizaciones" class="content-section" style="display:none;">
          <h2>Organizaciones de Voluntarios</h2>
          <div id="org-view">
            <div id="org-list-view">
              <button id="mostrar-org-create" class="action-btn">Crear Organizaci√≥n</button>
              <div id="org-list" class="list-box"></div>
            </div>
            <div id="org-create-form" class="form-container" style="display:none;">
              <h3>Nueva Organizaci√≥n</h3>
              <form id="crear-org-form">
                <input type="text" id="org-title" placeholder="T√≠tulo de la Organizaci√≥n" required />
                <textarea id="org-info-text" placeholder="M√°s informaci√≥n" required></textarea>
                <input type="file" id="org-image" accept="image/*" />
                <button type="submit" class="action-btn">Crear Organizaci√≥n</button>
                <button type="button" id="cancelar-org" class="return-btn">Volver</button>
              </form>
            </div>
            <div id="org-detail-view" style="display:none;">
              <button id="volver-org-list" class="return-btn">Volver</button>
              <div id="org-detail"></div>
              <div id="org-members">
                <h4>Miembros de la Organizaci√≥n:</h4>
                <ul id="org-member-list"></ul>
              </div>
              <button id="unirse-org" class="join-org-btn">Unirse a Organizaci√≥n</button>
              <div id="org-admin-chat" class="chat-container">
                <div class="chat-header">
                  <h3>Chat de Administradores</h3>
                  <button type="button" class="fullscreen-chat-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/Pantalla%20completa.png?raw=true" alt="Pantalla Completa" />
                  </button>
                </div>
                <div class="chat-messages" id="org-admin-chat-messages"></div>
                <form id="org-admin-chat-form">
                  <input type="text" id="org-admin-chat-input" placeholder="Escribe tu mensaje" required />
                  <button type="submit" class="enhanced-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20enviar.png?raw=true" class="send-icon" alt="Enviar" />
                    Enviar
                  </button>
                </form>
              </div>
              <div id="org-chat" class="chat-container">
                <div class="chat-header">
                  <h3>Chat de Organizaci√≥n</h3>
                  <button type="button" class="fullscreen-chat-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/Pantalla%20completa.png?raw=true" alt="Pantalla Completa" />
                  </button>
                </div>
                <div class="chat-messages" id="org-chat-messages"></div>
                <form id="org-chat-form">
                  <input type="text" id="org-chat-input" placeholder="Escribe tu mensaje" required />
                  <button type="submit" class="enhanced-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20enviar.png?raw=true" class="send-icon" alt="Enviar" />
                    Enviar
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- M√≥dulo: Mi Perfil -->
        <div id="perfil" class="content-section" style="display:none;">
          <h2>Mi Perfil</h2>
          <div class="profile-container-new">
            <div class="profile-display">
              <div class="profile-photo-container">
                <img id="profile-large-photo" src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20perfil.png?raw=true"
                  alt="Foto de Perfil" onerror="this.onerror=null; this.src='https://github.com/CharliePoten/People-For-People/blob/main/icono%20perfil.png?raw=true'" />
              </div>
              <div class="profile-info">
                <h3>Informaci√≥n de Perfil</h3>
                <p id="profile-username-display">Usuario: </p>
                <p id="profile-name-display">Nombre: </p>
                <p id="profile-surname-display">Apellido: </p>
                <p id="profile-dob-display">Fecha de nacimiento: </p>
                <p id="profile-formation-display">Formaci√≥n Profesional: </p>
                <div id="profile-attachments"></div>
              </div>
            </div>
            <div class="profile-settings">
              <h3>Ajustes de Perfil</h3>
              <div class="profile-tabs">
                <button type="button" class="profile-tab-btn active" data-target="profile-datos">Datos Personales</button>
                <button type="button" class="profile-tab-btn" data-target="profile-formacion">Formaci√≥n Profesional</button>
                <button type="button" class="profile-tab-btn" data-target="profile-foto">Cambiar Foto</button>
              </div>
              <div class="profile-tab-content" id="profile-datos" style="display:block;">
                <form id="profile-datos-form">
                  <input type="text" id="profile-nombre" placeholder="Nombre" required />
                  <input type="text" id="profile-apellido" placeholder="Apellido" required />
                  <input type="text" id="new-username" placeholder="Nombre de Usuario" />
                  <input type="date" id="profile-dob" required />
                  <input type="text" id="profile-phone" placeholder="Tel√©fono (opcional)" />
                  <button type="submit" class="enhanced-btn">Guardar Datos</button>
                </form>
              </div>
              <div class="profile-tab-content" id="profile-formacion">
                <form id="profile-formacion-form">
                  <input type="text" id="profile-titulo" placeholder="T√≠tulo" required />
                  <input type="text" id="profile-institucion" placeholder="Instituci√≥n" required />
                  <input type="number" id="profile-anio" placeholder="A√±o" required />
                  <button type="submit" class="enhanced-btn">Guardar Formaci√≥n</button>
                </form>
                <div class="file-attachment">
                  <h4>Adjuntar Archivo (para uso general)</h4>
                  <form id="profile-attachment-form">
                    <input type="text" id="attachment-title" placeholder="T√≠tulo del Archivo" required />
                    <input type="file" id="attachment-file" accept="application/pdf, image/*, .docx" required />
                    <label for="attachment-visibility">Visibilidad:</label>
                    <select id="attachment-visibility">
                      <option value="public">P√∫blico</option>
                      <option value="private" selected>Privado</option>
                    </select>
                    <button type="submit" class="enhanced-btn">Adjuntar Archivo</button>
                  </form>
                  <div id="profile-attachment-list"></div>
                </div>
              </div>
              <div class="profile-tab-content" id="profile-foto">
                <form id="profile-foto-form">
                  <input type="file" id="profile-new-photo" accept="image/*" required />
                  <button type="submit" class="enhanced-btn">Actualizar Foto</button>
                </form>
              </div>
              <div class="logout-section">
                <button type="button" id="logout-btn" class="logout-btn">Cerrar Sesi√≥n</button>
              </div>
            </div>
          </div>
          <div class="info-container">
            <div class="profile-info-section" id="info-center" style="display:none;">
              <h2>üìå Centro de Informaci√≥n</h2>
              <h3>üåü Nuestra Misi√≥n</h3>
              <p>Conectar a Voluntarios y Personas Necesitadas: Facilitamos la vinculaci√≥n entre quienes desean ayudar y aquellos que requieren asistencia.</p>
              <p>Coordinaci√≥n en Tiempo Real: Trabajamos junto a ONGs y autoridades para gestionar la ayuda de manera eficiente.</p>
              <h3>üì± ¬øC√≥mo Funciona?</h3>
              <p>Plataforma Intuitiva: Nuestra aplicaci√≥n permite a los voluntarios registrarse y ofrecer su ayuda seg√∫n su disponibilidad y habilidades.</p>
              <p>Notificaciones en Tiempo Real: Los voluntarios reciben alertas sobre necesidades urgentes en su √°rea.</p>
              <p>Colaboraci√≥n con Entidades: Coordinamos esfuerzos con ONGs y autoridades locales para asegurar una respuesta efectiva.</p>
              <h3>ü§ù Beneficios de Unirse</h3>
              <p>Impacto Directo: Tu ayuda llega directamente a quienes m√°s lo necesitan.</p>
              <p>Flexibilidad: Participa seg√∫n tu disponibilidad y capacidades.</p>
              <p>Comunidad Solidaria: Forma parte de una red comprometida con el bienestar com√∫n.</p>
              <p>üåê <a href="https://www.peopleforpeople.es/" target="_blank">Visite nuestra p√°gina WEB para m√°s informaci√≥n</a></p>
              <div id="file-upload-container" style="margin-top: 20px; display:none;">
                <h3>Subir Archivo</h3>
                <form id="file-upload-form">
                  <input type="text" id="attachment-title" placeholder="T√≠tulo del Archivo" required />
                  <input type="file" id="attachment-file" accept="application/pdf, image/*" required />
                  <button type="submit" class="enhanced-btn">Subir Archivo</button>
                </form>
                <div id="upload-message" style="margin-top: 10px;"></div>
              </div>
            </div>
            <div class="profile-info-section" id="support" style="display:none;">
              <h2>üìû Soporte y Ayuda</h2>
              <p>Bienvenido al centro de soporte. Estamos aqu√≠ para ayudarte con cualquier duda o problema que puedas tener.</p>
              <h3>üîπ Contacto con Soporte</h3>
              <p>Si necesitas asistencia personalizada, nuestro equipo est√° disponible para ayudarte.</p>
              <p>‚úâ Email: <a href="mailto:peopleforpeopleofficial@gmail.com">peopleforpeopleofficial@gmail.com</a></p>
              <p>üìû Tel√©fono: +34 699043862</p>
              <h3>üîπ Reportar un Problema</h3>
              <p>Si experimentas alg√∫n error o fallo en la aplicaci√≥n, rep√≥rtalo aqu√≠ y lo solucionaremos lo antes posible.</p>
              <p>üí¨ Chat en Vivo: Disponible en horario laboral</p>
              <div id="soporte-live-chat">
                <div class="chat-header">
                  <h3>Chat en Vivo</h3>
                  <button type="button" class="fullscreen-chat-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/Pantalla%20completa.png?raw=true" alt="Pantalla Completa" />
                  </button>
                </div>
                <div class="chat-messages" id="soporte-chat-messages" style="height:200px; overflow:auto; border:1px solid #ccc; padding:10px;"></div>
                <form id="soporte-chat-form">
                  <input type="text" id="soporte-chat-input" placeholder="Escribe tu mensaje" required />
                  <button type="submit" class="enhanced-btn">
                    <img src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20enviar.png?raw=true" class="send-icon" alt="Enviar" />
                    Enviar
                  </button>
                </form>
              </div>
              <h3>üîπ Sugerencias y Comentarios</h3>
              <p>Tu opini√≥n es importante para nosotros. D√©janos tus sugerencias para mejorar tu experiencia.</p>
              <div id="feedback-section">
                <form id="feedback-form">
                  <textarea id="feedback-text" placeholder="Escribe tu comentario aqu√≠" required></textarea>
                  <button type="submit" class="enhanced-btn">Enviar Comentario</button>
                </form>
              </div>
              <button id="admin-panel-link" class="enhanced-btn">Panel de Administrador</button>
              <div id="admin-panel" style="margin-top:20px; display:none; border: 1px solid #ccc; padding: 10px;">
                <h2>Panel de Administraci√≥n</h2>
                <form id="admin-login-form">
                  <input type="email" id="admin-email" placeholder="Email de Administrador" required />
                  <input type="password" id="admin-password" placeholder="Contrase√±a" required />
                  <button type="submit" class="enhanced-btn">Acceder</button>
                </form>
                <div id="admin-content" style="display:none;">
                  <button id="admin-logout-btn" class="enhanced-btn" style="float: right;">Cerrar Sesi√≥n</button>
                  <h3>Editar Informaci√≥n</h3>
                  <form id="admin-edit-form">
                    <textarea id="admin-info" placeholder="Nueva Informaci√≥n..." required></textarea>
                    <button type="submit" class="enhanced-btn">Guardar Cambios</button>
                  </form>
                  <h3>Subir Archivo</h3>
                  <form id="admin-upload-form">
                    <input type="text" id="admin-attachment-title" placeholder="T√≠tulo del Archivo" required />
                    <input type="file" id="admin-attachment-file" accept="application/pdf, image/*" required />
                    <button type="submit" class="enhanced-btn">Subir Archivo</button>
                  </form>
                  <div id="admin-upload-message" style="margin-top:10px;"></div>
                  <div id="admin-support-chats">
                    <h3>Chats de Soporte Abiertos</h3>
                    <div id="admin-support-chats-list" style="border:1px solid #ccc; padding:10px; max-height:200px; overflow:auto;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Secci√≥n Calendario (Agregada, solo en modo Voluntario) -->
        <div id="calendario" class="content-section" style="display: none;">
          <h2>Calendario</h2>
          <div id="calendar-controls">
            <button class="calendar-view-toggle" data-view="diario">Diario</button>
            <button class="calendar-view-toggle" data-view="mensual">Mensual</button>
            <button class="calendar-add-event">A√±adir Evento +</button>
          </div>
          <div id="calendar-container">
            <!-- Aqu√≠ se renderiza el grid del calendario -->
          </div>
          <div id="event-panel">
            <h3 id="event-panel-header">A√±adir Evento</h3>
            <div id="event-add-fields">
              <label>T√≠tulo del evento:</label>
              <input type="text" id="event-title-input" placeholder="T√≠tulo del evento" />
              <label>Informaci√≥n del evento:</label>
              <textarea id="event-info-input" placeholder="Descripci√≥n del evento"></textarea>
              <div id="event-day-diary" style="display:none;">
                <label>D√≠a de la semana:</label>
                <select id="event-day-select">
                  <option value="">Seleccione el d√≠a</option>
                  <option value="0">Lunes</option>
                  <option value="1">Martes</option>
                  <option value="2">Mi√©rcoles</option>
                  <option value="3">Jueves</option>
                  <option value="4">Viernes</option>
                  <option value="5">S√°bado</option>
                  <option value="6">Domingo</option>
                </select>
              </div>
              <div id="event-day-mensual" style="display:none;">
                <label>N√∫mero del d√≠a:</label>
                <input type="number" id="event-day-number" placeholder="Ingrese el n√∫mero del d√≠a" min="1" max="31" />
              </div>
              <label>De:</label>
              <input type="time" id="event-start-time" />
              <label>a:</label>
              <input type="time" id="event-end-time" />
            </div>
            <div style="text-align: center;">
              <button id="event-save">Guardar</button>
              <button id="event-cancel">Cancelar</button>
            </div>
            <div id="event-view-fields" style="display:none;">
              <h4>T√≠tulo:</h4>
              <p id="event-title-view"></p>
              <h4>Informaci√≥n:</h4>
              <p id="event-info-view"></p>
              <h4>Hora:</h4>
              <p id="event-time-view"></p>
              <h4>D√≠a:</h4>
              <p id="event-day-view"></p>
              <div style="text-align: center;">
                <button id="event-close">Cerrar</button>
              </div>
            </div>
          </div>
        </div>
      </main>
      <!-- Men√∫ inferior (Voluntario) -->
      <nav class="app-menu">
        <button class="menu-btn" data-target="map-view">
          <img class="menu-icon" src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20mapa.png?raw=true" alt="Icono Mapa" />
          Mapa
        </button>
        <button class="menu-btn" data-target="pedir-ayuda">
          <img class="menu-icon" src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20pedir%20ayuda.png?raw=true" alt="Icono Pedir Ayuda" />
          Pedir Ayuda
        </button>
        <button class="menu-btn" data-target="ofrecer-voluntario">
          <img class="menu-icon" src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20voluntario.png?raw=true" alt="Icono Voluntario" />
          Voluntarios
        </button>
        <button class="menu-btn" data-target="organizaciones">
          <img class="menu-icon" src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20organizaciones.png?raw=true" alt="Icono Organizaciones" />
          Organizaciones
        </button>
      </nav>
    </div>

    <!-- Contenedor para el Modo Organizador -->
    <div id="org-mode-app" class="screen org-mode" style="display: none;">
      <header class="app-header org-header">
        <h1 class="app-title">Modo Organizador</h1>
        <div class="header-actions">
          <!-- Se elimin√≥ el bot√≥n de "Cerrar Sesi√≥n" aqu√≠ para que el √∫nico bot√≥n sea el de Ajustes de Perfil -->
        </div>
      </header>
      <main class="app-content org-content">
        <p>Bienvenido al modo organizador. Selecciona una opci√≥n del men√∫ inferior.</p>
      </main>
      <nav class="app-menu org-app-menu">
        <button class="menu-btn org-menu-btn" data-target="org-chats">
          <img class="menu-icon" src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20chats.png?raw=true" alt="Icono Chats" />
          Centro de Chats
        </button>
        <button class="menu-btn org-menu-btn" data-target="org-info">
          <img class="menu-icon" src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20informacion.png?raw=true" alt="Icono Informaci√≥n" />
          People for People
        </button>
        <button class="menu-btn org-menu-btn" data-target="org-list">
          <img class="menu-icon" src="https://github.com/CharliePoten/People-For-People/blob/main/icono%20listas.png?raw=true" alt="Icono Mis Organizaciones" />
          Mis Organizaciones
        </button>
      </nav>
    </div>

    <!-- Modal para vista previa de archivos -->
    <div id="modal-viewer" class="modal">
      <div class="modal-content"></div>
    </div>

    <!-- Modal para T√©rminos de Privacidad -->
    <div id="terms-modal">
      <div class="modal-content">
        <span id="close-terms">&times;</span>
        <h2>T√©rminos de Privacidad</h2>
        <p>Aqu√≠ se detallan los t√©rminos y condiciones de privacidad. Por favor, t√≥mese el tiempo de leerlos detenidamente antes de continuar.</p>
        <img src="https://github.com/PeopleFP/PeopleFPWeb/blob/main/nutz%201.jpeg?raw=true" alt="T√©rminos 1" />
        <img src="https://github.com/PeopleFP/PeopleFPWeb/blob/main/nutz%202.jpeg?raw=true" alt="T√©rminos 2" />
      </div>
    </div>

    <!-- Modal para Modo Organizador: Seleccionar/Crear Organizaci√≥n -->
    <div id="org-mode-menu" class="modal">
      <div class="modal-content org-menu-content">
        <span class="close" id="close-org-menu">&times;</span>
        <h2>Modo Organizador</h2>
        <div class="org-menu-container">
          <div class="org-menu-header">
            <h3>Mis Organizaciones</h3>
            <button id="crear-org-organizador-btn" class="action-btn" style="background-color:#800080; color:white;">
              Crear Organizaci√≥n
            </button>
          </div>
          <div id="orgmode-list" class="list-box"></div>
          <div id="create-org-form-orgmode-container" style="display:none;" class="form-container">
            <h3>Crear Nueva Organizaci√≥n</h3>
            <form id="create-org-form-orgmode">
              <input type="text" id="orgmode-title" placeholder="T√≠tulo de la Organizaci√≥n" required />
              <textarea id="orgmode-info" placeholder="Informaci√≥n de la Organizaci√≥n" required></textarea>
              <input type="file" id="orgmode-image" accept="image/*" />
              <button type="submit" class="action-btn">Crear Organizaci√≥n</button>
              <button type="button" id="cancelar-org-modal" class="return-btn">Cancelar</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Nueva Pantalla de Bienvenida -->
    <div id="welcome-screen" style="display: none;">
      <div class="container">
        <h1 class="welcome-text" id="welcomeText"></h1>
        <img src="https://github.com/CharliePoten/People-For-People/blob/main/Logo%20People%20For%20People%20(2).png?raw=true" alt="Logo People For People" class="logo" />
        <p class="slogan">Tu ayuda, su esperanza. ¬°Nosotros os unimos!</p>
        <button id="start-btn" class="action-btn">Comenzar</button>
      </div>
      <style>
        /* Los estilos espec√≠ficos para #welcome-screen ya se definen en el bloque global */
      </style>
    </div>

    <!-- Carga as√≠ncrona de Google Maps -->
    <script>
      window.onload = function () {
        const script = document.createElement("script");
        script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBWlVP6ZrRsXVmKj4czhWxg6Q4bGIP8zeE&callback=initMap&v=weekly";
        script.async = true;
        script.defer = true;
        document.head.appendChild(script);
      };
    </script>

    <!-- Script para transiciones, animaci√≥n, cierre de sesi√≥n, alternancia de modos y dem√°s funcionalidades -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const fullWelcomeText = "Bienvenido a People For People";
        const welcomeTextElem = document.getElementById("welcomeText");
        let charIndex = 0;
      
        function typeWriter() {
          if (charIndex < fullWelcomeText.length) {
            welcomeTextElem.textContent += fullWelcomeText.charAt(charIndex);
            charIndex++;
            setTimeout(typeWriter, 100);
          } else {
            setTimeout(startWaveAnimation, 1000);
          }
        }
      
        function startWaveAnimation() {
          const letters = fullWelcomeText.split("");
          welcomeTextElem.innerHTML = letters
            .map(letter =>
              letter === " " ? `<span class="wave-letter" style="animation: none;">&nbsp;</span>` : `<span class="wave-letter">${letter}</span>`
            )
            .join("");
      
          function animateLetters() {
            const waveLetters = welcomeTextElem.querySelectorAll(".wave-letter");
            waveLetters.forEach((letter, i) => {
              if (letter.innerHTML.trim() !== "") {
                setTimeout(() => {
                  letter.classList.add("animate-wave");
                  letter.addEventListener("animationend", () => {
                    letter.classList.remove("animate-wave");
                  }, { once: true });
                }, i * 100);
              }
            });
            setTimeout(animateLetters, 7000);
          }
          animateLetters();
        }
      
        typeWriter();
      
        // Registro y bienvenida
        const registrationForm = document.getElementById("registration-form");
        registrationForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const registrationScreen = document.getElementById("registration-screen");
          registrationScreen.classList.add("fade-out");
          registrationScreen.addEventListener("transitionend", function handler() {
            registrationScreen.style.display = "none";
            registrationScreen.classList.remove("fade-out");
      
            const welcomeScreen = document.getElementById("welcome-screen");
            welcomeScreen.style.display = "flex";
            void welcomeScreen.offsetWidth;
            welcomeScreen.classList.add("visible");
            welcomeTextElem.textContent = "";
            charIndex = 0;
            typeWriter();
            const sloganEl = document.querySelector("#welcome-screen .slogan");
            const startBtnEl = document.querySelector("#welcome-screen #start-btn");
            void sloganEl.offsetWidth;
            void startBtnEl.offsetWidth;
            setTimeout(() => {
              sloganEl.classList.add("show");
              startBtnEl.classList.add("show");
              setTimeout(() => { startBtnEl.classList.add("pulse"); }, 2000);
            }, 100);
            registrationScreen.removeEventListener("transitionend", handler);
          });
        });
      
        setTimeout(function () {
          const registrationScreen = document.getElementById("registration-screen");
          if (window.getComputedStyle(registrationScreen).display === "none") {
            const welcomeScreen = document.getElementById("welcome-screen");
            welcomeTextElem.textContent = "";
            charIndex = 0;
            welcomeScreen.style.display = "flex";
            void welcomeScreen.offsetWidth;
            welcomeScreen.classList.add("visible");
            typeWriter();
            const sloganEl = document.querySelector("#welcome-screen .slogan");
            const startBtnEl = document.querySelector("#welcome-screen #start-btn");
            void sloganEl.offsetWidth;
            void startBtnEl.offsetWidth;
            setTimeout(() => {
              sloganEl.classList.add("show");
              startBtnEl.classList.add("show");
              setTimeout(() => { startBtnEl.classList.add("pulse"); }, 2000);
            }, 100);
          }
        }, 50);
      
        const startBtn = document.getElementById("start-btn");
        startBtn.addEventListener("click", function () {
          startBtn.classList.remove("pulse");
          const welcomeScreen = document.getElementById("welcome-screen");
          welcomeScreen.classList.add("fade-out");
          welcomeScreen.addEventListener("transitionend", function handler() {
            welcomeScreen.style.display = "none";
            document.getElementById("main-app").style.display = "block";
            welcomeScreen.removeEventListener("transitionend", handler);
          });
        });
      
        // Funcionalidad de pantalla completa en chats
        const fullscreenButtons = document.querySelectorAll('.fullscreen-chat-btn');
        fullscreenButtons.forEach(button => {
          button.addEventListener('click', function (e) {
            const chatContainer = this.closest('.chat-container');
            if (chatContainer) {
              if (!document.fullscreenElement) {
                chatContainer.requestFullscreen().catch(err => {
                  console.error(`Error al activar pantalla completa: ${err.message}`);
                });
              } else {
                document.exitFullscreen();
              }
            }
          });
        });
      
        // Men√∫ de navegaci√≥n (modo Voluntario)
        document.querySelectorAll('.menu-btn').forEach(btn => {
          btn.addEventListener('click', function () {
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove("active"));
            this.classList.add("active");
            document.querySelectorAll(".content-section").forEach(sec => { sec.style.display = "none"; });
            const eventPanel = document.getElementById("event-panel");
            if (eventPanel) { eventPanel.style.display = "none"; }
            let target = this.getAttribute("data-target");
            if (target) { document.getElementById(target).style.display = "block"; }
          });
        });
      
        // Bot√≥n de Calendario en header (modo Voluntario)
        document.getElementById("calendario-btn").addEventListener("click", function() {
          document.querySelectorAll(".content-section").forEach(sec => { sec.style.display = "none"; });
          document.querySelectorAll(".menu-btn").forEach(b => b.classList.remove("active"));
          document.getElementById("calendario").style.display = "block";
        });
      
        // Alternancia de modo (Voluntario <-> Organizador)
        let organizerMode = false;
        const modeToggleBtn = document.querySelector(".mode-toggle-btn");
        if (modeToggleBtn) {
          modeToggleBtn.addEventListener("click", function() {
            organizerMode = !organizerMode;
            if (organizerMode) {
              document.getElementById("main-app").style.display = "none";
              document.getElementById("org-mode-app").style.display = "block";
              document.getElementById("calendario-btn").style.display = "none";
              this.textContent = "Cambiar a Voluntario";
            } else {
              document.getElementById("org-mode-app").style.display = "none";
              document.getElementById("main-app").style.display = "block";
              document.getElementById("calendario-btn").style.display = "inline-block";
              this.textContent = "Cambiar a Organizador";
            }
          });
        }
      
        // Funci√≥n para cerrar sesi√≥n (Modo Voluntario) ‚Äì este es el √∫nico bot√≥n de logout que se debe utilizar
        const logoutBtn = document.getElementById("logout-btn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", function() {
            localStorage.clear();
            window.location.reload();
          });
        }
      
        // Se mantiene el event listener del admin-logout-btn por si acaso (aunque no afecta al logout principal)
        const adminLogoutBtn = document.getElementById("admin-logout-btn");
        if (adminLogoutBtn) {
          adminLogoutBtn.addEventListener("click", function() {
            localStorage.clear();
            window.location.reload();
          });
        }
      
      });
    </script>
      
    <!-- Script de Calendario (Modo Voluntario) -->
    <script>
      document.addEventListener("DOMContentLoaded", function(){
        (function(){
          const diarioTimes = [
            { start: "08:00", end: "10:00" },
            { start: "10:00", end: "12:00" },
            { start: "12:00", end: "14:00" },
            { start: "14:00", end: "16:00" }
          ];
          const semanalTimes = [
            { start: "08:00", end: "10:00" },
            { start: "10:00", end: "12:00" },
            { start: "12:00", end: "14:00" },
            { start: "14:00", end: "16:00" },
            { start: "16:00", end: "18:00" }
          ];
          const dayNames = ["Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b", "Dom"];
      
          let currentView = "diario";
          const calendarContainer = document.getElementById("calendar-container");
          const viewToggleButtons = document.querySelectorAll(".calendar-view-toggle");
          const addEventButton = document.querySelector(".calendar-add-event");
          const currentUser = localStorage.getItem("username") || "T√∫";
          const eventsKey = "calendarEvents_" + currentUser;
          let events = [];
          try {
            events = JSON.parse(localStorage.getItem(eventsKey)) || [];
          } catch (error) {
            console.error("Error leyendo eventos", error);
            events = [];
          }
      
          function saveEvents() {
            localStorage.setItem(eventsKey, JSON.stringify(events));
          }
      
          function renderCalendar() {
            calendarContainer.innerHTML = "";
            if (currentView === "diario") {
              renderDiarioView();
            } else if (currentView === "mensual") {
              renderMonthlyView();
            }
          }
      
          function renderDiarioView() {
            const headerRow = document.createElement("div");
            headerRow.className = "daily-header-row";
            const leftHeader = document.createElement("span");
            leftHeader.innerText = "D√≠a";
            const rightHeader = document.createElement("span");
            rightHeader.innerText = "Eventos";
            headerRow.appendChild(leftHeader);
            headerRow.appendChild(rightHeader);
            calendarContainer.appendChild(headerRow);
      
            const container = document.createElement("div");
            container.className = "daily-list";
            for (let i = 0; i < 7; i++) {
              const row = document.createElement("div");
              row.className = "daily-row";
              row.dataset.day = i;
      
              const leftCell = document.createElement("div");
              leftCell.className = "day-name";
              leftCell.innerText = dayNames[i];
      
              const rightCell = document.createElement("div");
              rightCell.className = "event-info";
              const eventObj = events.find(ev => ev.view === "diario" && parseInt(ev.day, 10) === i);
              if (eventObj) {
                rightCell.innerText = eventObj.title + " (" + eventObj.startTime + " a " + eventObj.endTime + ")";
                rightCell.style.color = "#32cd32";
                rightCell.addEventListener("click", function(e) {
                  e.stopPropagation();
                  showEventView(eventObj);
                });
              } else {
                rightCell.innerText = "Sin eventos";
              }
              row.appendChild(leftCell);
              row.appendChild(rightCell);
              row.addEventListener("click", function() { showEventPanel({ view: "diario", day: i }); });
              container.appendChild(row);
            }
            calendarContainer.appendChild(container);
          }
      
          function renderMonthlyView() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const numDays = new Date(year, month + 1, 0).getDate();
      
            const header = document.createElement("div");
            header.className = "monthly-header";
            dayNames.forEach(day => {
              const d = document.createElement("div");
              d.innerText = day;
              header.appendChild(d);
            });
            calendarContainer.appendChild(header);
      
            const grid = document.createElement("div");
            grid.className = "monthly-grid";
            for (let day = 1; day <= numDays; day++) {
              const cell = document.createElement("div");
              cell.className = "calendar-cell";
              cell.innerText = day;
              const eventObj = events.find(ev => ev.view === "mensual" && parseInt(ev.dayNumber, 10) === day);
              if (eventObj) {
                const evDiv = document.createElement("div");
                evDiv.className = "event-data";
                evDiv.style.background = "#32cd32";
                evDiv.style.color = "#fff";
                evDiv.style.padding = "2px 4px";
                evDiv.style.borderRadius = "4px";
                evDiv.style.position = "absolute";
                evDiv.style.bottom = "5px";
                evDiv.style.left = "5px";
                evDiv.style.right = "5px";
                evDiv.style.overflow = "hidden";
                evDiv.style.whiteSpace = "nowrap";
                evDiv.style.textOverflow = "ellipsis";
                evDiv.innerText = eventObj.title;
                evDiv.addEventListener("click", function(e) {
                  e.stopPropagation();
                  showEventView(eventObj);
                });
                cell.appendChild(evDiv);
              } else {
                cell.addEventListener("click", function() { showEventPanel({ view: "mensual", dayNumber: day }); });
              }
              grid.appendChild(cell);
            }
            calendarContainer.appendChild(grid);
          }
      
          let currentEventContext = null;
      
          function showEventPanel(context) {
            currentEventContext = context;
            document.getElementById("event-panel-header").innerText = "A√±adir Evento";
            document.getElementById("event-add-fields").style.display = "block";
            document.getElementById("event-view-fields").style.display = "none";
            if (currentView === "diario") {
              document.getElementById("event-day-diary").style.display = "block";
              document.getElementById("event-day-mensual").style.display = "none";
              if (typeof context.day !== "undefined") {
                document.getElementById("event-day-select").value = context.day;
                if (context.slot !== undefined) {
                  const slotData = diarioTimes[context.slot] || { start: "", end: "" };
                  document.getElementById("event-start-time").value = slotData.start;
                  document.getElementById("event-end-time").value = slotData.end;
                }
              }
            } else if (currentView === "mensual") {
              document.getElementById("event-day-diary").style.display = "none";
              document.getElementById("event-day-mensual").style.display = "block";
              if (typeof context.dayNumber !== "undefined") {
                document.getElementById("event-day-number").value = context.dayNumber;
              }
            }
            document.getElementById("event-title-input").value = "";
            document.getElementById("event-info-input").value = "";
            document.getElementById("event-panel").style.display = "block";
          }
      
          function showEventView(eventObj) {
            currentEventContext = null;
            document.getElementById("event-panel-header").innerText = "Detalles del Evento";
            document.getElementById("event-add-fields").style.display = "none";
            document.getElementById("event-view-fields").style.display = "block";
            document.getElementById("event-title-view").innerText = eventObj.title;
            document.getElementById("event-info-view").innerText = eventObj.info || "";
            if (eventObj.view === "diario") {
              document.getElementById("event-day-view").innerText = dayNames[eventObj.day];
            } else if (eventObj.view === "mensual") {
              document.getElementById("event-day-view").innerText = eventObj.dayNumber;
            }
            document.getElementById("event-time-view").innerText = eventObj.startTime + " a " + eventObj.endTime;
            document.getElementById("event-panel").style.display = "block";
          }
      
          function hideEventPanel() {
            document.getElementById("event-panel").style.display = "none";
            currentEventContext = null;
          }
      
          document.getElementById("event-save").addEventListener("click", function(){
            const title = document.getElementById("event-title-input").value.trim();
            const info = document.getElementById("event-info-input").value.trim();
            const startTime = document.getElementById("event-start-time").value;
            const endTime = document.getElementById("event-end-time").value;
            if (title && startTime && endTime) {
              let newEvent = {
                id: Date.now(),
                title: title,
                info: info,
                startTime: startTime,
                endTime: endTime,
                view: currentView
              };
              if (currentView === "diario") {
                const day = document.getElementById("event-day-select").value;
                if (day === "") return;
                newEvent.day = parseInt(day, 10);
              } else if (currentView === "mensual") {
                const dayNum = document.getElementById("event-day-number").value;
                if (dayNum === "") return;
                newEvent.dayNumber = parseInt(dayNum, 10);
              }
              events.push(newEvent);
              saveEvents();
              renderCalendar();
              hideEventPanel();
            }
          });
      
          document.getElementById("event-cancel").addEventListener("click", function(){
            hideEventPanel();
          });
          document.getElementById("event-close").addEventListener("click", function(){
            hideEventPanel();
          });
      
          viewToggleButtons.forEach(button => {
            button.addEventListener("click", function(){
              currentView = this.dataset.view;
              viewToggleButtons.forEach(btn => btn.classList.remove("active"));
              this.classList.add("active");
              renderCalendar();
            });
          });
      
          addEventButton.addEventListener("click", function(){
            showEventPanel({});
          });
      
          if (document.querySelector('.calendar-view-toggle[data-view="diario"]')) {
            document.querySelector('.calendar-view-toggle[data-view="diario"]').classList.add("active");
          }
          renderCalendar();
        })();
      });
    </script>
      
    <!-- Script para el Modal de T√©rminos de Privacidad -->
    <script>
      function openTermsModal() {
        document.getElementById("terms-modal").style.display = "block";
      }
      function closeTermsModal() {
        document.getElementById("terms-modal").style.display = "none";
      }
      document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("close-terms").addEventListener("click", closeTermsModal);
        // Cierra el modal si se hace clic fuera del contenido
        window.addEventListener("click", function(event) {
          var modal = document.getElementById("terms-modal");
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });
      });
    </script>
  </body>
</html>
